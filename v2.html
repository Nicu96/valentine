<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Forever ðŸ’–</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  height: 100vh;
  overflow: hidden;
  font-family: 'Segoe UI', sans-serif;
  background: radial-gradient(circle at top, #1a1a2e, #0f0f1b);
  color: white;
}

/* ðŸŒŸ Stars */
.stars { position: fixed; width: 100%; height: 100%; z-index: 0; }
.star { position: absolute; width: 2px; height: 2px; background: white; animation: twinkle 2s infinite alternate; }
@keyframes twinkle { from { opacity: 0.2; } to { opacity: 1; } }

/* ðŸ’Ž Card */
.container {
  position: relative;
  z-index: 2;
  width: 95%;
  max-width: 520px;
  margin: auto;
  top: 50%;
  transform: translateY(-50%);
  padding: 30px;
  border-radius: 25px;
  backdrop-filter: blur(15px);
  background: rgba(255, 255, 255, 0.08);
  box-shadow: 0 0 60px rgba(255, 77, 109, 0.4);
  text-align: center;
}

h1 {
  font-size: 2rem;
  margin-bottom: 20px;
  background: linear-gradient(90deg, #ff4d6d, #ff9a9e);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

#message { min-height: 80px; margin-bottom: 25px; line-height: 1.5; }

/* Input for her name */
#nameInputArea {
  margin-top: 30px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
}

#herName {
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 18px;
  width: 100%;
}

#startBtn {
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 18px;
  background: #ff4d6d;
  color: white;
  cursor: pointer;
  transition: 0.3s;
}

#startBtn:hover { transform: scale(1.05); }

button {
  padding: 12px 28px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  font-size: 16px;
  transition: 0.3s;
}

#yesBtn { background: #ff4d6d; color: white; box-shadow: 0 0 20px #ff4d6d; }
#yesBtn:hover { transform: scale(1.1); }

#noBtn { background: #666; color: white; }

/* ðŸŽ® Game */
#gameArea { display: none; margin-top: 20px; }
#playField {
  position: relative;
  width: 100%;
  height: 300px;
  background: rgba(255,255,255,0.05);
  border-radius: 15px;
  overflow: hidden;
  margin-top: 15px;
}

.fallingHeart { position: absolute; font-size: 24px; top: -30px; animation: fallGame linear forwards; }
.goldenHeart { color: gold; font-size: 30px; }

@keyframes fallGame { to { transform: translateY(350px); } }

#basket { position: absolute; bottom: 10px; font-size: 40px; left: 50%; transform: translateX(-50%); pointer-events: none; }

/* Drag bar */
#dragBarContainer { margin-top: 10px; display: none; }
#dragBar {
  -webkit-appearance: none;
  width: 100%;
  height: 16px;
  background: rgba(255,255,255,0.2);
  border-radius: 8px;
  outline: none;
  margin-top: 10px;
}

#dragBar::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #ff4d6d;
  cursor: pointer;
  border: none;
}

#dragBar::-moz-range-thumb {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #ff4d6d;
  cursor: pointer;
  border: none;
}

/* ðŸ’– Floating hearts background */
.heart { position: fixed; font-size: 20px; animation: floatUp 5s linear forwards; }
@keyframes floatUp { from { transform: translateY(100vh); opacity: 1; } to { transform: translateY(-10vh); opacity: 0; } }

/* Final message */
.final-text { font-size: 1.4rem; animation: fadeIn 2s ease forwards; }

/* Timer effect */
#time { transition: all 0.3s ease; display:inline-block; }
.flash { color: #ff4d6d; font-weight: bold; transform: scale(1.6); animation: bounceTime 0.5s infinite; }
@keyframes bounceTime { 0%,100% { transform: scale(1.6); } 50% { transform: scale(1.9); } }

/* Score bounce */
#score { display:inline-block; transition: transform 0.3s; }
.bounceScore { animation: bounceScore 0.5s ease; }
@keyframes bounceScore { 0% { transform: scale(1); } 25% { transform: scale(1.5); } 50% { transform: scale(1.8); } 75% { transform: scale(1.5); } 100% { transform: scale(1); } }

/* Buttons center for game start */
.buttons { display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap; }
</style>
</head>

<body>

<div class="stars"></div>

<div class="container">
  <h1>My Forever ðŸ’–</h1>

  <div id="nameInputArea">
    <input type="text" id="herName" placeholder="Type your lovely name...">
    <button id="startBtn">Start ðŸ’•</button>
  </div>

  <div id="message"></div>

  <div class="buttons" style="display:none;">
    <button id="yesBtn">Yes ðŸ’•</button>
    <button id="noBtn">No ðŸ™ˆ</button>
  </div>

  <div id="gameArea">
    <h2>Catch My Heart ðŸ’–</h2>
    <p>Score: <span id="score">0</span> | Time: <span id="time">20</span>s</p>
    <div id="playField"></div>
    <div id="dragBarContainer">
      <input type="range" id="dragBar" min="0" max="100" value="50">
    </div>
  </div>

  <div id="finalMessage" class="final-text"></div>
</div>

<script>
/* ðŸŒŸ Stars */
for (let i = 0; i < 120; i++) {
  const star = document.createElement("div");
  star.className = "star";
  star.style.top = Math.random() * 100 + "%";
  star.style.left = Math.random() * 100 + "%";
  document.querySelector(".stars").appendChild(star);
}

/* ðŸ’– Floating hearts background */
setInterval(() => {
  const heart = document.createElement("div");
  heart.className = "heart";
  heart.innerHTML = "ðŸ’–";
  heart.style.left = Math.random() * 100 + "vw";
  document.body.appendChild(heart);
  setTimeout(() => heart.remove(), 5000);
}, 600);

/* Elements */
const startBtn = document.getElementById("startBtn");
const herNameInput = document.getElementById("herName");
const messageElement = document.getElementById("message");
const buttonsDiv = document.querySelector(".buttons");
const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");
const gameArea = document.getElementById("gameArea");
const playField = document.getElementById("playField");
const scoreDisplay = document.getElementById("score");
const timeDisplay = document.getElementById("time");
const finalMessage = document.getElementById("finalMessage");
const dragBarContainer = document.getElementById("dragBarContainer");
const dragBar = document.getElementById("dragBar");

let score=0, timeLeft=20, gameInterval, heartInterval;
let herName = "";

/* Start with name input */
startBtn.onclick = () => {
  herName = herNameInput.value || "Sweetheart";
  document.getElementById("nameInputArea").style.display = "none";
  buttonsDiv.style.display = "flex";

  const messageText = `From the moment I saw your smile, my world changed, ${herName}. You are my today, my tomorrow, my forever. So... will you be my Valentine? ðŸ’–`;
  let i=0;
  messageElement.innerHTML="";
  function typeWriter(){
    if(i<messageText.length){
      messageElement.innerHTML+=messageText.charAt(i);
      i++;
      setTimeout(typeWriter, 40);
    }
  }
  typeWriter();
};

/* Escape No */
noBtn.addEventListener("mouseover", function() {
  this.style.transform = `translate(${Math.random()*200-100}px, ${Math.random()*200-100}px)`;
});

/* Start Game on Yes */
yesBtn.onclick = () => {
  buttonsDiv.style.display="none";
  messageElement.innerHTML="";
  messageElement.style.minHeight = '0';
  gameArea.style.display="block";

  dragBarContainer.style.display="block"; // show drag bar

  startGame();
};

/* Game Logic */
function startGame() {
  score=0; timeLeft=20;
  scoreDisplay.innerText=score;
  timeDisplay.innerText=timeLeft;

  const basket = document.createElement("div");
  basket.id="basket";
  basket.innerHTML="ðŸ§º";
  playField.appendChild(basket);

  /* Desktop mouse move */
  playField.addEventListener("mousemove", e => {
    if(window.innerWidth>768){
      const rect = playField.getBoundingClientRect();
      basket.style.left = (e.clientX - rect.left) + "px";
    }
  });

  /* Mobile drag bar */
  dragBar.oninput = () => {
    const pos = dragBar.value;
    basket.style.left = pos + "%";
  };

  heartInterval = setInterval(() => {
    const heart = document.createElement("div");
    const isGolden = Math.random()<0.15;
    heart.className = "fallingHeart";
    if(isGolden) heart.classList.add("goldenHeart");
    heart.innerHTML = isGolden ? "ðŸ’›" : "ðŸ’–";
    heart.style.left = Math.random()*90 + "%";
    heart.style.animationDuration = (Math.random()*2+2)+"s";
    playField.appendChild(heart);

    const check = setInterval(()=>{
      const h = heart.getBoundingClientRect();
      const b = basket.getBoundingClientRect();
      if(h.bottom>=b.top && h.left<b.right && h.right>b.left){
        score += isGolden?5:1;
        scoreDisplay.innerText=score;

        // ðŸ”¥ Add bounce effect
        scoreDisplay.classList.remove("bounceScore");
        void scoreDisplay.offsetWidth; // trigger reflow
        scoreDisplay.classList.add("bounceScore");

        heart.remove();
        clearInterval(check);
      }
    },50);
  },600);

  gameInterval = setInterval(()=>{
    timeLeft--;
    timeDisplay.innerText=timeLeft;
    if(timeLeft<=10){
      timeDisplay.classList.add("flash");
    } else { timeDisplay.classList.remove("flash"); }

    if(timeLeft<=0){
      clearInterval(gameInterval);
      clearInterval(heartInterval);
      endGame();
    }
  },1000);
}

/* End Game */
function endGame(){
  playField.innerHTML="";
  gameArea.style.display="none";
  dragBarContainer.style.display="none";
  finalMessage.innerHTML=`My heart is one and only, ${herName}. Always yours! ðŸ’–`;
  confetti({ particleCount: 300, spread: 120 });
}

</script>

</body>
</html>
